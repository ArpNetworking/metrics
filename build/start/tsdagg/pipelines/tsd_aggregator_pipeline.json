{
    "name": "TSDAggregatorPipeline",
    "service": "tsd_aggregator",
    "cluster": "tsd_aggregator_dev",
    "host": "tsd-agg-test1.local",
    "timerStatistics": [
        "min",
        "median",
        "p90",
        "p95",
        "p99",
        "p99p9",
        "max",
        "count",
        "mean",
        "sum"
    ],
    "counterStatistics": [
        "min",
        "median",
        "p90",
        "p95",
        "p99",
        "p99p9",
        "max",
        "count",
        "mean",
        "sum"
    ],
    "gaugeStatistics": [
        "min",
        "median",
        "p90",
        "p95",
        "p99",
        "p99p9",
        "max",
        "count",
        "mean",
        "sum"
    ],
    "statistics": {
        ".*age" : [ "max" ]
    },
    "sources":
    [
        {
            "type": "com.arpnetworking.tsdcore.sources.FileSource",
            "name": "tsd_aggregator_query_log",
            "sourceFile": "logs/tsd-aggregator-query.log",
            "stateFile": "logs/tsd-aggregator-query.log.state",
            "parser":
            {
                "type": "com.arpnetworking.tsdaggregator.parsers.QueryLogParser"
            }
        }
    ],
    "sinks":
    [
        {
            "type": "com.arpnetworking.tsdcore.sinks.ExpressionSink",
            "name": "tsd_aggregator_expression_sink",
            "dynamicConfigurationFactory":
            {
                "type": "com.arpnetworking.configuration.jackson.MergingDynamicConfigurationFactory",
                "factories":
                [
                    {
                        "type": "com.arpnetworking.configuration.jackson.DirectoryDynamicConfigurationFactory",
                        "directories": ["../../build/start/tsdagg/expressions"]
                    },
                    {
                        "type": "com.arpnetworking.remet.gui.ReMetGuiDynamicConfigurationFactory",
                        "uri": "http://localhost:8080/v1/expressions/query?limit=1"
                    }
                ]
            },
            "sink":
            {
                "type": "com.arpnetworking.tsdcore.sinks.AlertSink",
                "name": "tsd_aggregator_alert_sink",
                "dynamicConfigurationFactory":
                {
                    "type": "com.arpnetworking.configuration.jackson.MergingDynamicConfigurationFactory",
                    "factories":
                    [
                        {
                            "type": "com.arpnetworking.configuration.jackson.DirectoryDynamicConfigurationFactory",
                            "directories": ["../../build/start/tsdagg/alerts"]
                        },
                        {
                            "type": "com.arpnetworking.remet.gui.ReMetGuiDynamicConfigurationFactory",
                            "uri": "http://localhost:8080/v1/alerts/query?limit=1&context=HOST"
                        }
                    ]
                },
                "sink":
                {
                    "type": "com.arpnetworking.tsdcore.sinks.MultiSink",
                    "name": "tsd_aggregator_multi_sink",
                    "sinks":
                    [
                        {
                            "type": "com.arpnetworking.tsdcore.sinks.PeriodicStatisticsSink",
                            "name": "tsd_aggregator_periodic_statistics_sink"
                        },
                        {
                            "type": "com.arpnetworking.tsdcore.sinks.PeriodFilteringSink",
                            "name": "period_filtering_tsd_aggregator_remet_sink",
                            "include": ["PT1S"],
                            "excludeGreaterThan": "PT0S",
                            "sink":
                            {
                                "type": "com.arpnetworking.tsdcore.sinks.TimeThresholdSink",
                                "name": "time_threshold_tsd_aggregator_remet_sink",
                                "threshold": "PT10M",
                                "sink":
                                {
                                    "type": "com.arpnetworking.tsdcore.sinks.ReMetSink",
                                    "name": "tsd_aggregator_remet_sink",
                                    "uri": "http://localhost:7090/report"
                                }
                            }
                        },
                        {
                            "type": "com.arpnetworking.tsdcore.sinks.PeriodFilteringSink",
                            "name": "period_filtering_tsd_aggregator_cluster_sink",
                            "excludeLessThan": "PT1M",
                            "sink":
                            {
                                "type": "com.arpnetworking.tsdcore.sinks.TimeThresholdSink",
                                "name": "time_threshold_tsd_aggregator_cluster_sink",
                                "threshold": "PT10M",
                                "logOnly": true,
                                "sink":
                                {
                                    "type": "com.arpnetworking.tsdcore.sinks.AggregationServerSink",
                                    "name": "tsd_aggregator_cluster_sink",
                                    "serverAddress": "localhost",
                                    "serverPort": 7065
                                }
                            }
                        }
                    ]
                }
            }
        }
    ]
}
